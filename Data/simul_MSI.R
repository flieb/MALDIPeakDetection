library(Cardinal)

#create pattern:
pattern <- factor(c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,
                    0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,
                    0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,
                    0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,
                    0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,
                    0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,
                    0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,
                    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,
                    0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,
                    0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,
                    0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,
                    0,0,0,0,0,0,0,0,0,3,3,3,3,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,
                    0,0,0,0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,
                    0,0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,
                    0,0,0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                    0,0,0,0,0,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                    0,0,0,0,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                    0,0,0,0,0,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,
                    0,0,0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,
                    0,0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,
                    0,0,0,0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,
                    0,0,0,0,0,0,0,0,0,3,3,3,3,0,0,0,0,0,4,4,4,4,4,4,4,4,4,0,0,0,
                    0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,
                    0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,
                    0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,
                    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,
                    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0), levels=c(0,1,2,3,4))

#define coordinates:
coord <- expand.grid(x=1:30, y=1:30)

#set rng seed:
set.seed(2)

#peak locations:
cc <- c(200,400,500,600,800)

#create MSI dataset:
msset <- generateImage(pattern, coord=coord, range=c(1, 1000), centers=cc, resolution=35, baseline=1000, noise=1.5, delta=70, step=1.0, as="MSImageSet")

#visualize the shapes:
image(msset, mz=cc[1], col.regions=alpha.colors("blue", 100))
image(msset, mz=cc[2], col.regions=alpha.colors("black", 100))
image(msset, mz=cc[3], col.regions=alpha.colors("red", 100))
image(msset, mz=cc[4], col.regions=alpha.colors("green", 100))
image(msset, mz=cc[5], col.regions=alpha.colors("cyan", 100))

#plot some spectra:
plot(msset, pixel=1)
plot(msset, pixel=141)
plot(msset, pixel=121)

#save data as CSV for import to MATLAB:
write.csv(msset@imageData@data[["iData"]],'simul_MSI.csv')
